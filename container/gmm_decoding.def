BootStrap: docker
From: nvidia/cuda:11.3.0-cudnn8-runtime-ubuntu18.04

%files
    ./requirements.txt /requirements.txt

%environment
    export PATH=/opt/conda/bin:$PATH

%post
    apt-get -y update
    apt-get install -y --no-install-recommends procps curl vim ca-certificates libgles2-mesa-dev
    rm -rf /var/lib/apt/lists/*
    curl -o ./miniconda.sh -O https://repo.anaconda.com/miniconda/Miniconda3-py38_4.9.2-Linux-x86_64.sh
    chmod +x ./miniconda.sh
    ./miniconda.sh -b -p /opt/conda
    rm ./miniconda.sh
    /opt/conda/bin/conda update --all -y
    /opt/conda/bin/pip install -r /requirements.txt
    /opt/conda/bin/pip install scikit-image>=0.18 ome-zarr trackpy imagecodecs
    /opt/conda/bin/conda install -y numpy pyyaml scipy ipython mkl mkl-include cython typing dask-image tifffile pandas seaborn natsort pip
    /opt/conda/bin/conda install -y -c rapidsai -c conda-forge/label/cupy_rc -c conda-forge cucim dask-cuda cudatoolkit=11.2
    /opt/conda/bin/conda clean -ya

%labels
    Author BioinfoTongLI
    Version v0.0.1

